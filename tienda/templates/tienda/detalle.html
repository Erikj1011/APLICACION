{% extends 'tienda/base.html' %}
{% load static %}
{% block content %}
<div class="detalle-contenedor">
    <div class="detalle-card">
        <div class="detalle-imagen-wrap">
            {% if videojuego.imagen %}
                <img src="{{ videojuego.imagen.url }}" alt="{{ videojuego.nombre }}" onerror="fallback(this)">
            {% else %}
                <img src="{% static 'tienda/img/placeholder.svg' %}" alt="placeholder">
            {% endif %}
        </div>
        <div class="detalle-info">
            <h2>{{ videojuego.nombre }}</h2>
            <p>{{ videojuego.descripcion }}</p>
            <p class="precio">Precio: ${{ videojuego.precio }}</p>
            <p>Stock: {{ videojuego.stock }}</p>

            {% if user.is_authenticated %}
                <a href="{% url 'agregar_carrito' videojuego.pk %}" class="btn btn-agregar">Agregar al carrito</a>
            {% else %}
                <a href="{% url 'login' %}?next={% url 'detalle_videojuego' videojuego.pk %}" class="btn">Inicia sesión para agregar</a>
            {% endif %}
        </div>
    </div>

    <div class="resenas-seccion">
        <h3>Reseñas</h3>
        {% for res in resenas %}
            <div class="resena-card">
                <div class="resena-header">
                    <strong>{{ res.usuario.username }}</strong> <span>⭐ {{ res.calificacion }}/5</span>
                </div>
                <p>{{ res.comentario }}</p>
                <small>{{ res.fecha|date:"d M Y H:i" }}</small>
            </div>
        {% empty %}
            <p>Aún no hay reseñas.</p>
        {% endfor %}

        {% if user.is_authenticated %}
        <form action="{% url 'crear_resena' videojuego.pk %}" method="post" class="form-resena">
            {% csrf_token %}
            {{ form.comentario }}
            {{ form.calificacion }}
            <button class="btn btn-enviar" type="submit">Enviar reseña</button>
        </form>
        {% else %}
            <a href="{% url 'login' %}?next={% url 'detalle_videojuego' videojuego.pk %}" class="btn">Inicia sesión para dejar reseña</a>
        {% endif %}
    </div>
</div>
{% endblock %}
